define(["backbone","leaflet","leaflet-pip","jquery.geocodify","handlebars"],function(e,t,n,r,i){function g(e){e+="";var t=e.split("."),n=t[0],r=t.length>1?"."+t[1]:"",i=/(\d+)(\d{3})/;while(i.test(n))n=n.replace(i,"$1,$2");return n+r}function y(t,n){PopupLargeView=e.View.extend({el:t,initialize:function(){this.handlebarsHelpers(),this.render()},handlebarsHelpers:function(){i.registerHelper("compare",function(e,t,n,r){var i,s;if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");r===undefined&&(r=n,n=t,t="==="),i={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},"typeof":function(e,t){return typeof e==t}};if(!i[t])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+t);return s=i[t](e,n),s?r.fn(this):r.inverse(this)}),i.registerHelper("removeHTTP",function(e){e+="";var t=e.replace("http://www.",""),n=t.replace(".org/",".org"),r=n.replace(".com/",".com");return new i.SafeString(r)})},render:function(){var e=this.$el;e.empty();var t=$("#popups-large-template").html(),r=i.compile(t);return e.append(r(n)),$(window).width()>575&&$(".popup_cover").show(),$("#popup-box").find(".toggle_popup").show(),$("#popup-box").show(),this}}),popuplargeview=new PopupLargeView}function b(e){if(e.properties.REGION==="Yes")var t="#999";else var t="#EEE";return{color:"#FFF",weight:1,opacity:.8,fillOpacity:.5,fillColor:t}}function w(e){return{color:"#FFF",weight:1,opacity:.8,fillOpacity:.5,fillColor:"#999"}}function E(e){return{color:"#333",weight:1,opacity:.8,fillOpacity:0,fillColor:"FFF",clickable:!1}}function S(e,t){t.on({mouseover:function(e){var t=e.target;t.setStyle({fillOpacity:.95})},mouseout:function(e){var t=e.target;t.setStyle({color:"#FFFFFF",weight:1,opacity:.8,fillOpacity:.5})}});var n=t.feature.properties,r='<div class="popup_box"  id= "'+n.NAMELSAD10+'">';r='<div class="popup_box_header">'+n.NAMELSAD10+"</div>",r+="<hr />",e.properties.REGION==="Yes"?r+="This county is part of the MHDS region.":r+="This county is not part of the MHDS region.",t.bindPopup(r)}function x(e){return e*1069}function T(){c._map!==null&&c.bringToFront(),l._map!==null&&l.bringToFront()}function N(e){o.invalidateSize(),o.setView(new t.LatLng(e.lat(),e.lng()),10),o.invalidateSize(),h&&o.removeLayer(h),h=t.circle([e.lat(),e.lng()],x($("#radiusSelected").val()),{color:"red",fillColor:"#f03",fillOpacity:.1,clickable:!1}).addTo(o),T(),p&&o.removeLayer(p),p=t.marker([e.lat(),e.lng()],{draggable:!0,icon:d}),p.on("dragend",function(e){o.setView(e.target.getLatLng()),h.setLatLng(e.target.getLatLng()),C(h,x($("#radiusSelected").val())),h.redraw(),$("#geocoder_one-input").val("")}),C(h,x($("#radiusSelected").val())),p.addTo(o),window.location.hash==="#second"?window.location.hash="#map":window.location.hash==="#showlegend"&&(window.location.hash="#hidelegend")}function C(e,t){e!==undefined&&(arrayPip=n.pointInLayer(e.getLatLng(),f),arrayPip.length===0?($(".within-region").hide(),$(".not-within-region").show()):($(".not-within-region").hide(),$(".within-region").show()),circle_lat_long=e.getLatLng(),json_groups=[{file:"json_one",value:l,title_singular:"regional office",title_plural:"regional offices"},{file:"json_two",value:c,title_singular:"provider",title_plural:"providers"}],_.each(json_groups,function(e){var n=$("#dropdown_select").val(),r=e.file,i=e.value,s=e.title_singular,o=e.title_plural,u=0;i._map!==null&&i.eachLayer(function(e){layer_lat_long=e.getLatLng(),distance_from_layer_circle=layer_lat_long.distanceTo(circle_lat_long),distance_from_layer_circle<=t&&(u+=1)}),u===1?$("#"+r+"_title").html(s):$("#"+r+"_title").html(o),$("#"+r+"_results").html(u),$("#results-radius-mobile").html("within "+$("#radiusSelected").val()+" miles")},this))}var s,o,u,a,f,l=new t.FeatureGroup,c=new t.FeatureGroup,h,p,d=t.AwesomeMarkers.icon({icon:"icon-circle",color:"red"}),v,m;return t.Icon.Default.imagePath="css/images",{baseMap:function(){s=new t.map("map_one",{dragging:!1,keyboard:!1,touchZoom:!1,scrollWheelZoom:!1,doubleClickZoom:!1,boxZoom:!1,zoomControl:!1,attributionControl:!1,minZoom:1,maxZoom:100})},baseMapTwo:function(){o=new t.map("map",{layers:t.tileLayer.provider("Stamen.Toner"),center:[42.748903,-93.3],zoom:7,minZoom:5,maxZoom:17,maxBounds:[[38.95,-101.88],[44.85,-85.35]]}),$(window).width()<626&&o.setView([42.748903,-92.856445],6)},mapInvalidateSize:function(){o.invalidateSize()},resetZoom:function(){function e(){$("#zoom-to-iowa a").css({"background-color":"#fff",color:"#333",cursor:"pointer"})}$("#zoom-to-iowa a").click(function(){o.setView([42.748903,-93.3],7),$(this).css({"background-color":"#f4f4f4",color:"#bbb",cursor:"text"})}),o.on("dragend",function(t){e()}),o.on("zoomend",function(t){o.getZoom()!==8&&e()})},geoJSON:function(){u=t.geoJson(polygons,{style:b,onEachFeature:S}).addTo(s),a=t.geoJson(polygon_ia,{style:E}).addTo(s),s.fitBounds(u.getBounds())},geoJSONTwo:function(){f=t.geoJson(polygons_ne_ia,{style:w}).addTo(o),f.eachLayer(function(e){e._path.setAttribute("style","cursor: default;")})},resetMap:function(){o.removeLayer(geojson)},loadJSON:function(){function e(e,n,r){var i=0;_.each(e,function(r){i+=1;var s=r.latitude,u=r.longitude,a=new t.LatLng(s,u);$(window).width()<576?set_radius=10:set_radius=7;var f=t.circleMarker(a,{radius:set_radius,fillColor:n,color:"#FFFFFF",weight:1,opacity:1,fillOpacity:.8});f.on({mouseover:function(e){var t=e.target;t.setStyle({radius:set_radius,fillColor:"#FFFFFF",color:"#000000",weight:1,opacity:1,fillOpacity:1})},click:function(e){v!==undefined&&v!==""&&v!==null&&v.setStyle({radius:set_radius,fillColor:m,color:"#FFFFFF",weight:1,opacity:1,fillOpacity:.8});var t=e.target;t.setStyle({radius:set_radius+1,fillColor:"#FFFFFF",color:"#000000",weight:2,opacity:1,fillOpacity:1}),v=t,m=n},mouseout:function(e){var t=e.target;t.setStyle({radius:set_radius,fillColor:n,color:"#FFFFFF",weight:1,opacity:1,fillOpacity:.8})}}),function(t){function n(n){var r=n.target;e===json_data?content_array=[{header:t.county,body:[{title:"Address",value:t.address01},{title:"Address02",value:t.address02},{title:"City",value:t.city},{title:"Address_City",value:t.address01+" "+t.city},{title:"Phone",value:t.phone},{title:"Services",value:t.services}]}]:e===json_data_two&&(content_array=[{header:t.name,body:[{title:"Address",value:t.address01},{title:"Address02",value:t.address02},{title:"Address03",value:t.address03},{title:"City",value:t.city},{title:"Address_City",value:t.address01+" "+t.city},{title:"Phone",value:t.phone},{title:"24-hour phone",value:t["24_hour_phone"]},{title:"Website",value:t.website},{title:"Services",value:t.services},{title:"Services_etc",value:t.services_two},{title:"Services_etc",value:t.services_three},{title:"Services_etc",value:t.services_four},{title:"Services_etc",value:t.services_five}]}]),y("#popup-box",content_array)}f.on({click:n}),e===json_data?l.addLayer(f):e===json_data_two&&c.addLayer(f)}(r),$("#json_two").prop("checked")===!0&&o.addLayer(c),$("#json_one").prop("checked")===!0&&o.addLayer(l)},this),$("#"+r).html(i)}e(json_data_two,"#4daf4a","json_two_results"),e(json_data,"#984ea3","json_one_results")},removeJSON:function(){function e(e){$("#json_"+e+"_results").css({visibility:"visible"}),$("#json_"+e+"_title").css({color:"#333"})}function t(e){$("json_"+e+"_results").html(""),$("#json_"+e+"_results").css({visibility:"hidden"}),$("#json_"+e+"_title").css({color:"#CCC"})}$("#json_two").prop("checked")===!0?(o.addLayer(c),e("two")):(o.removeLayer(c),t("two")),$("#json_one").prop("checked")===!0?(o.addLayer(l),e("one")):(o.removeLayer(l),$("json_one_results").html(""),t("one")),h!==undefined&&h!==""&&C(h,x($("#radiusSelected").val()))},geocode:function(){function i(i){i.geocodify({onSelect:function(e){var t=e.geometry.location;N(t)},initialText:"Enter your address...",regionBias:"US",viewportBias:new google.maps.LatLngBounds(new google.maps.LatLng(41.896016,-95.223999),new google.maps.LatLng(43.749935,-90.175781)),width:300,height:26,fontSize:"14px",filterResults:function(i){var s=[];return $.each(i,function(i,o){var u=o.geometry.location;u.lat()>t&&u.lat()<e&&u.lng()>n&&u.lng()<r&&s.push(o)}),s}})}var e=43.749935,t=40.217754,n=-96.459961,r=-90.175781,s=["one","two"];_.each(s,function(e){i($("#geocoder_"+e))},this)},clearGeocoders:function(){var e=$("#geocoder_one-input"),t=$("#geocoder_two-input");t.val("")},legendTableView:function(){var t=!1,n=!0;LegendTableView=e.View.extend({el:"body",events:{"click .toggle_description":"panelDisplay","click .popup .toggle_popup":"closeLargePopup","click #toggle-table":"openTablePopup","change select":"changeCircleRadius"},panelDisplay:function(){var e=$("#menu-panel").hasClass("ui-panel-closed"),t=$("#menu-panel").hasClass("ui-panel-open");e?($("#menu-panel").panel().panel("open"),$("#credits").show()):t&&($("#menu-panel").panel().panel("close"),$("#credits").hide())},closeLargePopup:function(){$(".popup_cover").hide(),$(".toggle_popup").hide(),$(".popup").hide(),$("#footer-table").hide(),v!==undefined&&v!==""&&v!==null&&v.setStyle({radius:set_radius,fillColor:m,color:"#FFFFFF",weight:1,opacity:1,fillOpacity:.8})},openTablePopup:function(){$(".popup_cover").show(),$(".toggle_popup").show(),$("#content-box").show(),$(window).width()<626&&$("#footer-table").show()},changeCircleRadius:function(e){C(h,x($("#radiusSelected").val())),h&&h.setRadius(x($("#radiusSelected").val())),window.location.hash==="#showlegend"&&$("#geocoder_one-input").val()!==""&&(window.location.hash="#hidelegend")}}),legendtableview=new LegendTableView},hideShowTables:function(e){$(".dataTables_wrapper").hide(),e!==undefined&&e!==""&&e!==null?($(".table-name").text(e),e=e.replace(/ /g,""),$("#searchable-"+e+"_wrapper").show()):($("#searchable-Regionaloffices_wrapper").show(),$("#nav_regional").css({"background-color":"#D6D6D6","border-top":"1px solid #BEBEBE","border-left":"1px solid #BEBEBE","border-right":"1px solid #BEBEBE"}))}}});